<?xml version='1.0'?>
<?xml-stylesheet type='application/xslt+xml' href='stylesheets/html.xsl'?>
<doc:module xmlns='http://www.w3.org/1999/xhtml' xmlns:doc='xefis-doc'>
	<doc:meta>
		<doc:title>AFCS - Automated Flight Control System</doc:title>
		<doc:name>systems/afcs</doc:name>
	</doc:meta>
	<section>
		<h1>Description</h1>
		<p>
			AFCS is a module that controls autothrottle and flight director modules by engaging different modes suitable for given type of flight.
			There are three parts to be controlled: speed or thrust (controlled by A/T), lateral movement (controlled by plane roll) and vertical movement
			(controlled by plane pitch). FMA (Flight Mode Annunciator) shows current and armed modes on EFIS. AFCS provides string properties
			to be displayed on EFIS for active and armed modes. AFCS is controlled by boolean properties representing buttons and rotary encoders on MCP (Mode Control Panel).
			AFCS provides boolean properties telling which LEDs under the buttons should be lit.
		</p>
	</section>
	<section>
		<h1>A/T modes</h1>
		<table style='width: 100%'>
			<tr>
				<th scope='col'>Mode</th>
				<th scope='col'>A/T controls</th>
				<th scope='col'>Description</th>
			</tr>
			<tr>
				<td><doc:fma>TO/GA</doc:fma></td>
				<td>thrust</td>
				<td>Use maximum thrust available (for limited amount of time).</td>
			</tr>
			<tr>
				<td><doc:fma>THR</doc:fma></td>
				<td>thrust</td>
				<td>Maintain maximum continuous thrust.</td>
			</tr>
			<tr>
				<td><doc:fma>THR REF</doc:fma></td>
				<td>thrust</td>
				<td>Maintain reference thrust (different for descent and climb) pointed by green caret on N1 thrust indicators on EICAS.</td>
			</tr>
			<tr>
				<td><doc:fma>IDLE</doc:fma></td>
				<td>thrust</td>
				<td>Maintain minimum thrust.</td>
			</tr>
			<tr>
				<td><doc:fma>SPD REF</doc:fma></td>
				<td>airspeed</td>
				<td>Maintain computed airspeed (different for descent, cruise and climb) pointed by REF marker on speed ladder on EFIS.</td>
			</tr>
			<tr>
				<td><doc:fma>SPD SEL</doc:fma></td>
				<td>airspeed</td>
				<td>Change airspeed to the one selected on MCP counter (operation in progress).</td>
			</tr>
			<tr>
				<td><doc:fma>MCP SPD</doc:fma></td>
				<td>airspeed</td>
				<td>Maintain airspeed selected on MCP counter. Set after MCP speed is acquired.</td>
			</tr>
			<tr>
				<td><doc:fma>HOLD</doc:fma></td>
				<td>airspeed</td>
				<td>Maintain airspeed present at the moment the HOLD mode was engaged.</td>
			</tr>
		</table>
	</section>
	<section>
		<h1>Roll modes</h1>
		<table style='width: 100%'>
			<tr>
				<th scope='col'>Mode</th>
				<th scope='col'>Controls</th>
				<th scope='col'>Description</th>
			</tr>
			<tr>
				<td><doc:fma>HDG SEL</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to turn to MCP-selected heading.</td>
			</tr>
			<tr>
				<td><doc:fma>HDG HOLD</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to hold onto current heading.</td>
			</tr>
			<tr>
				<td><doc:fma>HDG</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to hold onto MCP-selected heading.</td>
			</tr>
			<tr>
				<td><doc:fma>TRK SEL</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to turn to MCP-selected track.</td>
			</tr>
			<tr>
				<td><doc:fma>TRK HOLD</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to hold onto current track.</td>
			</tr>
			<tr>
				<td><doc:fma>TRK</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll to hold onto MCP-selected track.</td>
			</tr>
			<tr>
				<td><doc:fma>LVL</doc:fma></td>
				<td>roll</td>
				<td>Level wings.</td>
			</tr>
			<tr>
				<td><doc:fma>LOC</doc:fma></td>
				<td>lateral flight path</td>
				<td>Command roll do hold onto localizer path.</td>
			</tr>
		</table>
	</section>
	<section>
		<h1>Pitch modes</h1>
		<table style='width: 100%'>
			<tr>
				<th scope='col'>Mode</th>
				<th scope='col'>Pitch controls</th>
				<th scope='col'>Description</th>
			</tr>
			<tr>
				<td><doc:fma>FLCH SPD</doc:fma></td>
				<td>airspeed</td>
				<td>
					Change altitude mode. Target altitude is selected by the altitude counter. When selected altitude is reached,
					vertical mode is automatically changed to ALT.
				</td>
			</tr>
			<tr>
				<td><doc:fma>FLCH V/S</doc:fma></td>
				<td>vertical&#xa0;speed</td>
				<td>Just like FLCH&#xa0;SPD, but pitch is used to control vertical speed.</td>
			</tr>
			<tr>
				<td><doc:fma>FLCH FPA</doc:fma></td>
				<td>flight&#xa0;path</td>
				<td>Just like FLCH&#xa0;SPD, but pitch is used to maintain vertical flight path angle.</td>
			</tr>
			<tr>
				<td><doc:fma>V/S</doc:fma></td>
				<td>vertical&#xa0;speed</td>
				<td>Maintain vertical speed set on MCP counter.</td>
			</tr>
			<tr>
				<td><doc:fma>FPA</doc:fma></td>
				<td>flight&#xa0;path</td>
				<td>Maintain flight path angle set on MCP counter.</td>
			</tr>
			<tr>
				<td><doc:fma>CLB/CON</doc:fma></td>
				<td>airspeed</td>
				<td>Climb with maximum continuous thrust.</td>
			</tr>
			<tr>
				<td><doc:fma>VNAV SPD</doc:fma></td>
				<td>airspeed</td>
				<td>Command pitch to hold selected airspeed.</td>
			</tr>
			<tr>
				<td><doc:fma>VNAV PTH</doc:fma></td>
				<td>flight&#xa0;path</td>
				<td>Command pitch to hold configured target altitude or VNAV path.</td>
			</tr>
			<tr>
				<td><doc:fma>ALT</doc:fma></td>
				<td>altitude</td>
				<td>Command pitch to hold MCP selected altitude. Set after MCP altitude is acquired.</td>
			</tr>
			<tr>
				<td><doc:fma>ALT HOLD</doc:fma></td>
				<td>altitude</td>
				<td>Command pitch to hold current altitude.</td>
			</tr>
			<tr>
				<td><doc:fma>G/S</doc:fma></td>
				<td>flight&#xa0;path</td>
				<td>Command pitch do hold onto glide slope path.</td>
			</tr>
		</table>
	</section>
	<section>
		<h1>MCP panel buttons</h1>
		<p>Each button has corresponding property to control it. If button has a LED light, there's also a property that controls that light.
			Refer to the input and output properties tables.</p>
		<section>
			<h1>Speed subpanel</h1>
			<section>
				<p><doc:btn>SPD SEL</doc:btn></p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						<p>Set A/T mode to <doc:fma>SPD SEL</doc:fma>.</p>
						<p>For the pitch mode, the following changes apply:</p>
						<ul>
							<li>
								<p><doc:fma>FLCH SPD</doc:fma> changes to:</p>
								<ul>
									<li><doc:fma>ALT HOLD</doc:fma> if current absolute value of V/S is below or equal to <code>altitude_hold_threshold_vs</code>,</li>
									<li><doc:fma>FLCH V/S</doc:fma> otherwise.</li>
								</ul>
							</li>
							<li>
								<p><doc:fma>CLB/CON</doc:fma> changes to:</p>
								<ul>
									<li><doc:fma>ALT HOLD</doc:fma> if current absolute value of V/S is below or equal to <code>altitude_hold_threshold_vs</code>,</li>
									<li><doc:fma>V/S</doc:fma> otherwise.</li>
								</ul>
							</li>
							<li>
								<p><doc:fma>VNAV SPD</doc:fma> changes to <doc:fma>ALT HOLD</doc:fma></p>
							</li>
							<li>Other (non airspeed) modes are kept.</li>
						</ul>
					</dd>
					<dt>When target speed is reached</dt>
					<dd>Change A/T mode to <doc:fma>MCP SPD</doc:fma>.</dd>
				</dl>
			</section>
			<section>
				<p><doc:btn>HOLD</doc:btn> on speed panel</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						<p>Set A/T mode to <doc:fma>HOLD</doc:fma></p>
						<p>Pitch mode changes are exactly the same as when pressing <doc:btn>SPD SEL</doc:btn> button.</p>
					</dd>
				</dl>
			</section>
		</section>
		<section>
			<h1>Heading subpanel</h1>
			<section>
				<p><doc:btn>HDG SEL</doc:btn></p>
				<dl>
					<dt>When engaged</dt>
					<dd>Change roll mode to <doc:fma>HDG SEL</doc:fma> or <doc:fma>TRK SEL</doc:fma>.</dd>
					<dt>When disengaged</dt>
					<dd>Change roll mode to <doc:fma>LVL</doc:fma></dd>
					<dt>When target heading/track is acquired</dt>
					<dd>Change roll mode to <doc:fma>HDG</doc:fma> or <doc:fma>TRK</doc:fma>.</dd>
				</dl>
			</section>
			<section>
				<p><doc:btn>HOLD</doc:btn> on heading panel</p>
				<dl>
					<dt>When engaged</dt>
					<dd>Change roll mode to <doc:fma>HDG HOLD</doc:fma> or <doc:fma>TRK HOLD</doc:fma>.</dd>
				</dl>
			</section>
			<section>
				<p><doc:btn>LNAV</doc:btn></p>
				<p>Engage LNAV roll mode.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>Change roll mode to <doc:fma>LNAV</doc:fma>.</dd>
					<dt>When disengaged</dt>
					<dd>Change roll mode to <doc:fma>HDG HOLD</doc:fma> or <doc:fma>TRK HOLD</doc:fma>.</dd>
				</dl>
			</section>
		</section>
		<section>
			<h1>Altitude subpanel</h1>
			<section>
				<p><doc:btn>FLCH</doc:btn></p>
				<p>Engage flight level change mode.</p>
				<p>Aircraft will climb or descend to altitude selected by altitude MCP counter.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						<p>A/T mode is set to <doc:fma>THR REF</doc:fma> for climb, or <doc:fma>IDLE</doc:fma> for descent. Pitch mode is set to <doc:fma>FLCH SPD</doc:fma>.</p>
					</dd>
					<dt>When target altitude is reached</dt>
					<dd>A/T mode is set to <doc:fma>SPD REF</doc:fma>. Pitch mode is set to <doc:fma>ALT</doc:fma>.</dd>
					<dt>When disengaged</dt>
					<dd>
						<p>A/T mode is set to <doc:fma>SPD REF</doc:fma>. Pitch mode is set to <doc:fma>ALT HOLD</doc:fma></p>
						<p>Thrust reference is set to cruise thrust. Speed reference is set to cruise speed.</p>
					</dd>
				</dl>
			</section>
			<section>
				<p><doc:btn>HOLD</doc:btn> on altitude panel</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						<p>Change pitch mode to <doc:fma>ALT HOLD</doc:fma>.</p>
						<p>Thrust reference is set to cruise thrust. Speed reference is set to cruise speed.</p>
						<p>Speed mode changes:</p>
						<ul>
							<li><doc:fma>TO/GA</doc:fma>, <doc:fma>THR</doc:fma> and <doc:fma>IDLE</doc:fma> changes to <doc:fma>SPD REF</doc:fma>.</li>
							<li>Other speed modes are kept.</li>
						</ul>
					</dd>
				</dl>
			</section>
		</section>
		<section>
			<h1>Vertical speed subpanel</h1>
			<section>
				<p><doc:btn>VS/FPA</doc:btn></p>
				<p>Climb or descend with VS or FPA selected on the counter.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						If A/T operates in thrust mode, it's changed to <doc:fma>SPD REF</doc:fma> for climb or descent. If A/T operates in speed mode, no change is applied.
						If FLCH mode was engaged, pitch mode is set to <doc:fma>FLCH V/S</doc:fma> or <doc:fma>FLCH FPA</doc:fma>. Otherwise,
						pitch mode is set to <doc:fma>V/S</doc:fma> or <doc:fma>FPA</doc:fma>.
					</dd>
					<dt>When disengaged</dt>
					<dd>
						If FLCH was engaged, vertical speed is set to default, A/T mode is set back to <doc:fma>THR REF</doc:fma>.
						If FLCH was not engaged, A/T mode is set to <doc:fma>MCP SPD</doc:fma>, pitch mode is set to <doc:fma>ALT HOLD</doc:fma>.
					</dd>
				</dl>
				<p>Mode disengages when vertical speed or FPA is set to 0 or in the opposite direction than the commanded altitude. Above mode changes apply.</p>
			</section>
			<section>
				<p><doc:btn>V/S&#xa0;HOLD</doc:btn></p>
				<p>Maintain current vertical speed with pitch.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						<p>MCP counter is set to current vertical speed.</p>
						<p>If A/T operates in thrust mode, it's changed to <doc:fma>SPD REF</doc:fma> for climb or descent. If A/T operates in speed mode, no change is applied.
						Pitch mode is set to <doc:fma>V/S</doc:fma>.</p>
					</dd>
					<dt>When disengaged</dt>
					<dd><doc:todo/></dd>
				</dl>
				<p>Disengages when vertical speed is set to 0 on the counter.</p>
			</section>
			<section>
				<p><doc:btn>CLB/CON</doc:btn></p>
				<p>Climb with maximum continuous thrust and airspeed set on MCP counter.</p>
				<dl>
					<dt>A/T</dt>
					<dd><doc:fma>THR</doc:fma></dd>
					<dt>Pitch mode</dt>
					<dd><doc:fma>CLB/CON</doc:fma></dd>
				</dl>
			</section>
			<section>
				<p><doc:btn>VNAV</doc:btn></p>
				<p>Engage VNAV pitch mode.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						A/T mode is changed to <doc:fma>SPD REF</doc:fma> for cruise.
					</dd>
					<dt>When disengaged</dt>
					<dd>
						<doc:todo/>
					</dd>
				</dl>
			</section>
		</section>
		<section>
			<h1>Other buttons</h1>
			<section>
				<p><doc:btn>APP</doc:btn></p>
				<p>Arm or change to LOC/G/S modes. This mode uses ILS localizer and glide slope information for guiding aircraft.</p>
				<dl>
					<dt>When engaged</dt>
					<dd>
						If localizer/glide slope is available, changes roll/pitch modes to <doc:fma>LOC</doc:fma>/<doc:fma>G/S</doc:fma>.
						If unavailable, arms LOC and G/S modes and activates them as soon as localizer/glide slope is captured.
						A/T mode is changed to <doc:fma>SPD REF</doc:fma> for approach as soon as glide slope is captured.
					</dd>
					<dt>When disengaged</dt>
					<dd>
						<doc:todo/>
					</dd>
				</dl>
			</section>
		</section>
	</section>
	<section>
		<h1>Failures</h1>
		<doc:todo/> Opis kiedy tryby się disengagują, np. jeśli zniknie info o TRK (z GPS) czy coś. Wtedy wyłącza się A/P lub A/T lub oba.
		<p>When remote control is unavailable, A/P and A/T will never disengage.</p>
	</section>
	<section>
		<h1>Input</h1>
		<doc:todo/>
	</section>
	<section>
		<h1>Output</h1>
		<doc:todo/>
	</section>
</doc:module>
